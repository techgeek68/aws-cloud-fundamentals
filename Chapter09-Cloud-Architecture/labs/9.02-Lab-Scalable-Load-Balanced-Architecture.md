## Lab: Architecture Scaling and Load Balancing

---

**Elastic Load Balancing (ELB)** is an AWS service that helps distribute incoming traffic across multiple resources, such as EC2 instances, containers, or IP addresses, so that no single component becomes overwhelmed. By directing traffic only to healthy targets and operating across multiple Availability Zones, ELB helps keep applications available, resilient, and able to scale automatically as demand changes. AWS offers four types of load balancers, each designed for different kinds of applications.

**The Application Load Balancer (ALB)** works at the application layer (Layer 7) and is ideal for handling HTTP and HTTPS traffic. It supports smart routing based on factors such as URL paths or hostnames, making it a great fit for microservices and container-based setups.

**The Network Load Balancer (NLB)** operates at the transport layer (Layer 4) and is built for extremely fast, low-latency traffic such as TCP, UDP, and TLS. It can manage millions of requests per second and offers static IP addresses.

**The Gateway Load Balancer (GLB)** functions at the network layer (Layer 3) and helps simplify the deployment and scaling of third-party virtual appliances like firewalls or intrusion detection systems.

**Classic Load Balancer (CLB)** is an older-generation option that works at both Layer 4 and Layer 7. AWS now recommends migrating to ALB or NLB, especially since CLB was designed for the legacy EC2-Classic network.



**AWS Auto Scaling** is a service that monitors your applications and automatically adjusts resource capacity so performance stays consistent and costs remain under control. It ensures you have the right amount of compute power exactly when you need it.

**Dynamic scaling** responds in real time by adding or removing capacity based on CloudWatch metrics such as CPU usage or network activity.

**Target tracking scaling** is a type of dynamic scaling that aims to maintain a specific metric—like average CPU utilization—at a target level by adjusting the number of instances.

**Step scaling** changes capacity in predefined increments depending on how much a CloudWatch alarm is breached.

**Predictive scaling** uses machine learning to anticipate future traffic trends and adjusts capacity ahead of time, making it ideal for predictable spikes in usage.

**Scheduled scaling** lets you set specific times to scale resources up or down, such as boosting capacity during business hours and reducing it overnight.


Amazon **CloudWatch** is a monitoring and observability service that helps you keep track of your AWS resources, applications, and even on-premises systems. It gives you the data and insights you need to understand how your applications are performing, make better use of your resources, and maintain the overall health of your environment.
CloudWatch gathers operational data such as metrics, logs, and events and brings them together to create a single, cohesive view of your system’s performance.

---


**Architectural diagram:** 

```
+------------------------------- AWS Account ---------------------------------+
| Region: us-east-1                                                           |
|                                                                             |
|  +----------------------- ASB-Lab (10.0.0.0/16) ------------------------+   |
|  |                                                                       |  |
|  |  +-------- Public Subnet A (10.0.1.0/24) -------+   +-------------+   |  |
|  |  |                                              |   | Public      |   |  |
|  |  |  Application Load Balancer (HTTP:80)         |   | Subnet B    |   |  |
|  |  |  - SG: ALB Security Group                    |<->| (10.0.2.0/  |   |  |
|  |  |  - AZ: us-east-1a                            |   | 24),        |   |  |
|  |  +----------------------------------------------+   | AZ: us-east |   |  |
|  |                                                     | -1b         |   |  |
|  |                                                     +-------------+   |  |
|  |                                                                       |  |
|  |                                                                       |  |
|  |  +------- Private Subnet A (10.0.3.0/24) -------+   +--------------+  |  |
|  |  | Auto Scaling Group (EC2)                     |   | Private      |  |  |
|  |  | - SG: EC2 Security Group                     |<->| Subnet B     |  |  |
|  |  | - AZ: us-east-1a                             |   | (10.0.4.0/   |  |  |
|  |  +----------------------------------------------+   | 24),         |  |  |
|  |                                                     | AZ: us-east  |  |  |
|  |                                                     +--------------+  |  |
|  |                                                                       |  |
|  |  Internet Gateway (IGW) for public subnets                            |  |
|  |  - Public RT: 0.0.0.0/0 -> IGW                                        |  |
|  |  - Private RT: no direct IGW route                                    |  |
|  +-----------------------------------------------------------------------+  |
|                                                                             |
| CloudWatch: Detailed monitoring, metrics, alarms (CPU target tracking)      |
| SNS: Email alerts on scaling events                                         |
+-----------------------------------------------------------------------------+
```


---


**Step 1: Set Up the VPC and Subnets**

1. **Create a VPC**
   - Go to **VPC Dashboard** > **Create VPC**
      - VPC and more
      - Name tag: `ASB-Lab`
      - IPv4 CIDR: `10.0.0.0/16`
      - Tenancy: `Default`
      - Number of Availability Zones (AZs): `2`
      - Number of public subnets:`2`
      - Number of private subnets:`2`
      - Enable DNS resolution: Checked
      - Enable DNS hostnames: Checked

2. **Subnets**
  The above action will result in:
     - `ASB-Lab-subnet-public1-us-east-1a`
     - `ASB-Lab-subnet-public2-us-east-1b`
     - `ASB-Lab-subnet-private1-us-east-1a`
     - `ASB-Lab-subnet-private2-us-east-1b`
     
<img width="1058" height="306" alt="Screenshot 2025-11-14 at 8 13 42 AM" src="https://github.com/user-attachments/assets/cf9a3ab3-7a67-43f2-917a-a8f12341ec3d" />

<img width="1053" height="297" alt="Screenshot 2025-11-14 at 8 13 52 AM" src="https://github.com/user-attachments/assets/dbb5bdac-8696-4042-9eca-6701641e127c" />

<img width="1060" height="307" alt="Screenshot 2025-11-14 at 8 14 00 AM" src="https://github.com/user-attachments/assets/5b743a5c-d220-4488-8680-2e4a8bb97cd1" />

<img width="1070" height="309" alt="Screenshot 2025-11-14 at 8 14 09 AM" src="https://github.com/user-attachments/assets/5bb4028e-0904-4cfb-a07a-41ee5df942f1" />


3. **Internet Gateway**
      - VPC > Internet gateways
      - `ASB-Lab-igw` will be automatically attached to `ASB-Lab`

4. **Route Tables**
      - VPC > Route tables
      - Select public route table `ASB-Lab-rtb-public`. Inspect `Routes` to `0.0.0.0/0` and `10.0.0.0/16` via Internet Gateway and local, associate with Public Subnets
      - Inspect Private route table: No direct route to IGW


**Step 3: Launch and Configure Initial EC2 Instance**

1. Go to **EC2 > Instances > Launch Instances**.
2. Configure:
    - Name: `MyAppServer`
    - AMI: Amazon Linux
    - Instance type: `t2.micro`
    - Key pair: Create
    - Network: Use the earlier VPC, `ASB-Lab`
    - Subnet: `ASB-Lab-subnet-public1-us-east-1a`             # Public subnet for initial testing
    - Auto-assign public IP: `Enable`
    - Security Group:
       - Create a Security Group:
          - Security group name: `ASB Security Group`
          - Inbound rules:
            - Allow HTTP (TCP/80) from anywhere `0.0.0.0/0`
            - Allow SSH (TCP/22) from anywhere `0.0.0.0/0`
          - Outbound: > Type: All traffic > Destination type: Anywhere-IPV4

3. **Advanced details**
      - Detailed CloudWatch monitoring: Enable
      - User Data:
         - Add a script to install and start your web app.
```
#!/bin/bash
sudo dnf update -y
sudo dnf install -y httpd php-cli php-fpm php-mysqlnd php-common php-gd php-xml php-opcache php-curl
sudo systemctl enable --now php-fpm httpd
```

4. **Launch** the instance and wait until the status is `running`.

   
**SSH login**:
   - EC2 > Instances
   - Select Instance > Connect > SSH client
      - Example: ssh -i "AWSLabCSIT2087.pem" ec2-user@ec2-18-206-71-43.compute-1.amazonaws.com

```bash
cd /var/www/html
```

- Create health page: `sudo vi health.php`
  
```php
<?php
// Lightweight health endpoint for ALB Target Group
http_response_code(200);
header('Content-Type: text/plain');
echo "OK";
```
> A minimal endpoint that immediately returns HTTP
A minimal endpoint that immediately returns HTTP 200 OK (plain “OK”) so the ALB target group health checks pass quickly without generating load.

   - Create index page `sudo vim index.php`
```php
<?php
// Optional: make the root path work for users
header('Location: /load.php', true, 302);
exit;
```

   - Create `sudo vim load.php`
```php
<?php
// Pure render page (no CPU burn here). All load work is async via /api/load_api.php.
header('Content-Type: text/html; charset=utf-8');
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cloud Foundations Lab — Async Load Test</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">
  <link href="/css/overrides.css" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='28' fill='%235f85ff'/%3E%3Cpath d='M18 34h28M24 26h16' stroke='%23fff' stroke-width='4' stroke-linecap='round'/%3E%3C/svg%3E">
</head>
<body>
  <div class="page">
    <header class="header">
      <div class="brand">
        <div class="logo">CF</div>
        <div class="titles">
          <h1>Cloud Foundations Lab</h1>
          <p class="subtitle">Scalable Load-Balanced Architecture</p>
        </div>
      </div>
      <div class="pill ok" id="status-pill">
        <span class="dot" id="status-dot"></span>
        <span id="status-text">Idle</span>
      </div>
    </header>

    <main class="container">
      <section class="hero card">
        <div class="hero-text">
          <h2>On-Demand CPU Load</h2>
          <p class="lead">
            Click “Generate Load” to burn CPU on THIS instance without a page refresh. Use different durations to push Auto Scaling.
          </p>
        </div>
        <div class="stats">
          <div class="stat"><span class="label">Instance ID</span><span class="value" id="stat-instance">—</span></div>
          <div class="stat"><span class="label">AZ</span><span class="value" id="stat-az">—</span></div>
          <div class="stat"><span class="label">Server IP</span><span class="value" id="stat-ip">—</span></div>
          <div class="stat"><span class="label">Now (UTC)</span><span class="value" id="stat-now">—</span></div>
        </div>
      </section>

      <section class="controls card">
        <div class="control-row">
          <div class="control">
            <label for="seconds">Load duration</label>
            <div class="range-wrap">
              <input id="seconds" type="range" min="1" max="10" step="1" value="4">
              <div class="range-value"><span id="secVal">4</span>s</div>
            </div>
            <p class="hint">CPU burn length (1–10 seconds).</p>
          </div>
          <div class="actions">
            <button id="run" class="btn primary">Generate Load</button>
            <button id="cancel" class="btn ghost" disabled>Cancel</button>
            <a class="btn ghost" href="/health.php" target="_blank">Health check</a>
          </div>
        </div>
        <div class="progress-wrap">
          <div class="spinner" id="spinner" hidden></div>
          <div class="progress" id="progress" hidden><div class="bar" id="bar"></div></div>
          <div class="progress-text" id="progress-text">Ready</div>
        </div>
      </section>

      <section class="status card">
        <div class="status-row">
          <div class="status-icon" id="status-icon"></div>
          <div class="status-text">
            <h3 id="headline">Ready</h3>
            <p id="details">Click Generate Load to begin a CPU burn.</p>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <p>ALB distributes requests; Auto Scaling adds capacity when average CPU crosses target.</p>
    </footer>
  </div>

<script>
(function() {
  const range = document.getElementById('seconds');
  const secVal = document.getElementById('secVal');
  const runBtn = document.getElementById('run');
  const cancelBtn = document.getElementById('cancel');
  const spinner = document.getElementById('spinner');
  const progress = document.getElementById('progress');
  const bar = document.getElementById('bar');
  const progressText = document.getElementById('progress-text');
  const statusPill = document.getElementById('status-pill');
  const statusText = document.getElementById('status-text');
  const statusIcon = document.getElementById('status-icon');
  const headline = document.getElementById('headline');
  const details = document.getElementById('details');
  const statInstance = document.getElementById('stat-instance');
  const statAz = document.getElementById('stat-az');
  const statIp = document.getElementById('stat-ip');
  const statNow = document.getElementById('stat-now');

  let ctrl = null, tick = null, startMs = 0, target = 0;

  function updateClock() {
    const now = new Date();
    statNow.textContent = now.toISOString().slice(0,19).replace('T',' ') + ' UTC';
  }
  setInterval(updateClock, 1000); updateClock();

  range.addEventListener('input', () => secVal.textContent = range.value);

  function setIdle() {
    if (tick) { clearInterval(tick); tick = null; }
    spinner.hidden = true; progress.hidden = true;
    bar.style.width = '0%'; progressText.textContent = 'Ready';
    runBtn.disabled = false; cancelBtn.disabled = true;
    statusPill.classList.add('ok'); statusPill.classList.remove('muted');
    statusText.textContent = 'Idle';
    statusIcon.style.background = 'var(--ok)';
    headline.textContent = 'Ready';
  }

  function setRunning() {
    spinner.hidden = false; progress.hidden = false;
    progressText.textContent = 'Running...';
    runBtn.disabled = true; cancelBtn.disabled = false;
    statusPill.classList.remove('ok'); statusPill.classList.add('muted');
    statusText.textContent = 'Running';
    statusIcon.style.background = 'var(--warn)';
    headline.textContent = 'Generating CPU Load';
  }

  cancelBtn.addEventListener('click', () => {
    if (ctrl) ctrl.abort();
    details.textContent = 'Canceled.';
    setIdle();
  });

  runBtn.addEventListener('click', async () => {
    target = Math.max(1, Math.min(10, parseInt(range.value,10) || 4));
    startMs = Date.now();
    ctrl = new AbortController();
    setRunning();
    tick = setInterval(() => {
      const elapsed = (Date.now() - startMs)/1000;
      const pct = Math.min(100, (elapsed/target)*100);
      bar.style.width = pct + '%';
      progressText.textContent = `Running... ${elapsed.toFixed(1)}s / ${target}s`;
    }, 120);

    try {
      const r = await fetch(`/api/load_api.php?s=${target}`, {
        signal: ctrl.signal,
        headers: {'Accept':'application/json'}
      });
      if (!r.ok) throw new Error('HTTP '+r.status);
      const data = await r.json();
      if (tick) { clearInterval(tick); tick = null; }
      bar.style.width = '100%';
      progressText.textContent = `Completed in ${data.elapsed_sec.toFixed(2)}s`;
      statInstance.textContent = data.instance_id || 'Unknown';
      statAz.textContent = data.availability_zone || 'Unknown';
      statIp.textContent = data.server_ip || 'Unknown';
      statNow.textContent = data.ended_at_utc || statNow.textContent;
      headline.textContent = 'Load Completed';
      details.innerHTML = `Burned <strong>${data.seconds_requested}s</strong> of CPU.`;
    } catch (e) {
      if (e.name !== 'AbortError') {
        if (tick) clearInterval(tick);
        progressText.textContent = 'Error';
        headline.textContent = 'Error';
        details.textContent = 'Failed: ' + e.message;
        statusIcon.style.background = 'var(--danger)';
      }
    } finally {
      setIdle();
    }
  });

  setIdle(); // initialize
})();
</script>
</body>
</html>
```

- Create an Index page: `sudo vi index.php`
```php
<?php
// Redirect root to the async load test UI
header('Location: /load.php', true, 302);
exit;
```

- Create `load_api.php`
```php
<?php
// Returns JSON after burning CPU for N seconds (1–10).
header('Content-Type: application/json; charset=utf-8');
$req = isset($_GET['s']) ? (int)$_GET['s'] : 4;
$seconds = max(1, min(10, $req));
$started = microtime(true);

function imdsv2_get($path) {
    if (!function_exists('curl_init')) return null;
    $tokenCh = curl_init('http://169.254.169.254/latest/api/token');
    curl_setopt_array($tokenCh, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_CUSTOMREQUEST  => 'PUT',
        CURLOPT_HTTPHEADER     => ['X-aws-ec2-metadata-token-ttl-seconds: 300'],
        CURLOPT_CONNECTTIMEOUT => 1,
        CURLOPT_TIMEOUT        => 2
    ]);
    $token = curl_exec($tokenCh);
    curl_close($tokenCh);
    if (!$token) return null;
    $ch = curl_init("http://169.254.169.254/latest/meta-data/$path");
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_HTTPHEADER     => ["X-aws-ec2-metadata-token: $token"],
        CURLOPT_CONNECTTIMEOUT => 1,
        CURLOPT_TIMEOUT        => 2
    ]);
    $resp = curl_exec($ch);
    curl_close($ch);
    return $resp ?: null;
}

// CPU burn
$loopStart = microtime(true);
$iters = 0;
while ((microtime(true) - $loopStart) < $seconds) {
    sqrt(mt_rand());
    if ((++$iters % 500000) === 0) { usleep(0); }
}

$ended = microtime(true);
echo json_encode([
  'ok' => true,
  'seconds_requested' => $seconds,
  'elapsed_sec' => $ended - $started,
  'started_at_utc' => gmdate('Y-m-d H:i:s', (int)$started).' UTC',
  'ended_at_utc' => gmdate('Y-m-d H:i:s', (int)$ended).' UTC',
  'instance_id' => imdsv2_get('instance-id'),
  'availability_zone' => imdsv2_get('placement/availability-zone'),
  'server_ip' => $_SERVER['SERVER_ADDR'] ?? null
], JSON_UNESCAPED_SLASHES);
```

- `sudo mkdir css && cd css`
   - vi styles.css
```css
/* Your original big styles file (unchanged). Keep as-is.
   If you accidentally pasted it into load.php, move it here instead. */
:root {
  --bg:#0f1221; --bg-elev:#141831; --card:#171c3a; --border:rgba(255,255,255,0.08);
  --text:#e7ebff; --muted:#a7b0d1; --brand:#5f85ff; --brand-2:#8a5fff;
  --ok:#3ddc97; --warn:#ffb020; --danger:#ff6b6b; --shadow:0 10px 30px rgba(0,0,0,0.35);
  --radius:16px; --radius-sm:12px; --radius-lg:20px; --spacing:20px;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--text);background:
  radial-gradient(1200px 600px at 10% -10%, rgba(95,133,255,0.18), transparent 60%),
  radial-gradient(900px 500px at 120% 10%, rgba(138,95,255,0.14), transparent 60%),
  linear-gradient(180deg,#0b0e1a 0%,#0f1221 100%);
  font:400 16px/1.6 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
}
.page{display:grid;grid-template-rows:auto 1fr auto;min-height:100%}
.header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:18px min(5vw,32px);border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(23,28,58,0.8),rgba(23,28,58,0.6));backdrop-filter:blur(6px)}
.brand{display:flex;align-items:center;gap:14px}
.logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--brand-2));display:grid;place-items:center;color:#fff;font-weight:800;letter-spacing:.5px;box-shadow:var(--shadow)}
.titles h1{margin:0;font-size:20px;font-weight:700}
.titles .subtitle{margin:0;color:var(--muted);font-size:13px}
.pill{display:inline-flex;align-items:center;gap:10px;padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,0.04);color:var(--muted)}
.pill.ok{color:#c8ffe5;background:rgba(61,220,151,0.08);border-color:rgba(61,220,151,0.28)}
.pill .dot{width:10px;height:10px;border-radius:50%;background:var(--ok);box-shadow:0 0 0 6px rgba(61,220,151,0.15)}
.container{max-width:1100px;margin:32px auto;padding:0 16px;display:grid;gap:24px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:clamp(16px,3vw,26px)}
.hero{display:grid;gap:18px}
.hero-text h2{margin:0 0 6px;font-size:clamp(20px,3vw,26px)}
.lead{margin:0;color:var(--muted)}
.stats{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:14px}
@media (max-width:860px){.stats{grid-template-columns:repeat(2,minmax(0,1fr))}}
@media (max-width:520px){.stats{grid-template-columns:1fr}}
.stat{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;display:grid;gap:6px}
.stat .label{color:var(--muted);font-size:12px;letter-spacing:.3px;text-transform:uppercase}
.stat .value{font-size:15px;font-weight:600;word-break:break-word}
.controls .control-row{display:grid;grid-template-columns:1.4fr 1fr auto;gap:18px;align-items:end}
@media (max-width:820px){.controls .control-row{grid-template-columns:1fr}}
.control label{display:block;font-weight:600;margin-bottom:10px}
.range-wrap{display:grid;grid-template-columns:1fr auto;gap:14px;align-items:center}
input[type=range]{width:100%;appearance:none;height:8px;background:linear-gradient(90deg,var(--brand),var(--brand-2));border-radius:999px;outline:none}
input[type=range]::-webkit-slider-thumb{appearance:none;width:20px;height:20px;border-radius:50%;background:#fff;border:3px solid var(--brand);box-shadow:0 6px 16px rgba(95,133,255,0.35)}
.range-value{min-width:54px;text-align:right;font-weight:700}
.actions{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border-radius:10px;padding:10px 14px;font-weight:600;border:1px solid var(--border);background:rgba(255,255,255,0.02);color:var(--text);text-decoration:none;cursor:pointer}
.btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));border:none;color:#fff}
.status .status-row{display:grid;grid-template-columns:auto 1fr;gap:14px;align-items:center}
.status-icon{width:14px;height:14px;border-radius:50%;background:var(--warn);box-shadow:0 0 0 10px rgba(255,176,32,0.16)}
.footer{text-align:center;color:var(--muted);padding:20px;border-top:1px solid var(--border);margin-top:10px}
@media (prefers-color-scheme:light){
  :root{--bg:#f6f8ff;--bg-elev:#fff;--card:#fff;--border:rgba(24,36,56,0.12);--text:#111628;--muted:#4f5b78;--shadow:0 10px 30px rgba(36,56,99,0.12)}
  body{background:radial-gradient(1200px 600px at -10% -10%,rgba(95,133,255,0.15),transparent 60%),radial-gradient(900px 500px at 120% 10%,rgba(138,95,255,0.12),transparent 60%),linear-gradient(180deg,#eef2ff 0%,#f6f8ff 100%)}
}
```

- `sudo vi overrides.css`
```css
.progress-wrap {
  display:grid;
  grid-template-columns:auto 1fr;
  gap:14px;
  align-items:center;
  margin-top:12px;
}
.progress {
  width:100%;height:10px;
  background:rgba(255,255,255,0.08);
  border:1px solid var(--border);
  border-radius:999px;
  overflow:hidden;
}
.progress .bar {
  height:100%;width:0%;
  background:linear-gradient(90deg,var(--brand),var(--brand-2));
  transition:width .1s linear;
}
.spinner {
  width:16px;height:16px;
  border:2px solid rgba(255,255,255,0.25);
  border-top-color:#fff;
  border-radius:50%;
  animation:spin .8s linear infinite;
}
@keyframes spin {to{transform:rotate(360deg)}}
#status-icon {
  width:14px;height:14px;border-radius:50%;
  background:var(--ok);
  box-shadow:0 0 0 10px rgba(61,220,151,0.16);
}
```

Verification checklist:

curl -I http://INSTANCE_IP/load.php should show Content-Type: text/html
curl http://INSTANCE_IP/api/load_api.php?s=2 returns JSON (no HTML, no CSS)
Page no longer auto-refreshes; only updates when you press Generate Load




**Step 4: Create an AMI (Machine Image) from the Instance**
1. In EC2 > Instances, select `MyAppServer`.
2. Actions > Image and templates > Create image**.
    - Image name: `AppServerAMI`
    - Description: `Lab AMI for APP Server`
3. Click Create image and wait for it to appear in EC2 > AMIs. Wait until status: Available.


**Step 5: Create Target Group and Load Balancer**

**a) Create Target Group**
> Targets are the individual instances that will respond to requests from the Load Balancer.

1. EC2 > Load Balancing > Target Groups
2. Create target group:
   - Target type: Instances
   - Target group name: `LabTargetGroup`
   - Protocol
   - VPC: `ASB-Lab-vpc`
   - Protocol version: HTTP1
   - Health checks: Protocol `HTTP`, Health check path: `/health.php`
   - Advanced health check settings 
      - Traffic port
      - Healthy threshold: 2
      - Unhealthy threshold: 2
      - Timeout: 5s
      - Interval: 10s
      - Success codes: 200
   - Next, the `Register targets` screen appears. Next.
   - Create a target group


**b) Create Load Balancer**

1. EC2 > Load Balancing > Load Balancers > Create Load Balancer
2. Type: **Application Load Balancer**
   - Name: `ALB`
   - Scheme: Internet-facing
   - Load balancer IP address type: IPv4
   - VPC: `ASB-Lab-vpc`
   - Availability Zones and Subnets: Select both, assign Public Subnet 1 & 2
     - us-east-1a:
        - `ASB-Lab-subnet-public1-us-east-1a`
     - us-east-1b:
        - `ASB-Lab-subnet-public1-us-east-1b`
   - Security Groups: Attach `ASB Security Group` and remove `default`
   - Listeners and routing
      - Protocol: `HTTP` Port:80
      - Default action > Forward to target group `LabTargetGroup`
3. Create a load balancer and note the DNS name


**Step 6: Create Launch Template**

1. EC2 > Instances > Launch Templates > Create launch template
   - Name: `ALBConfig`
   - Template version description: V1.0
   - Auto Scaling guidance: (✓) 
   - AMI: My AMIs > Owned by me > Select `AppServerAMI`
   - Instance type: `t2.micro`
   - Key pair: Select the key that was created previously
   - Security Group:  Select the security group that was created previously
   -Advanced details
      - Enable Detailed CloudWatch Monitoring
      - Create launch template
        
   - EC2 > Instances > Launch Templates 
      - From the Actions menu, choose Create Auto Scaling group (Step 7 Cont.)


**Step 7: Configure Auto Scaling Group**

1. **Create Auto Scaling Group**
   - EC2 > Auto Scaling Groups > Create
   - Name: `ALB Scaling Group`
   - Launch template: `ALBConfig`
Next
   - VPC: `ASB-Lab`
   - Subnets: Private Subnet 1 & 2
   - Availability Zone distribution: Balanced best effort
Next
   - Attach to an existing load balancer
      - Choose from your load balancer target groups > select `LabTargetGroup | HTTP`
   - Turn on Elastic Load Balancing health checks
   - Turn on Amazon EBS health checks
Next
   - Group size:
     - Desired capacity: 2
     - Scaling 
        - Min: 2
        - Max: 6
   - Automatic scaling - optional > Target tracking scaling policy
     - Name: `ASBScalingPolicy`
     - Metric: Average CPU Utilization
     - Target value: 60
     - Additional settings:
        - Monitoring  
           - (✓) Select Enable group metrics collection within CloudWatch
Next
   - Add notifications - optional
     - Notification 1
       - Create Topic:
         -  Send a notification to: `MyAppWatch`
         -  With these recipients: `Your email ID`
Next
   - Tags: Key=`Name`, Value=`Lab Instance`
   - Review & Create Auto Scaling group


**Step 8: Verify Load Balancing & Auto Scaling**

1. **Check Instances**
   - EC2 Dashboard > Instances
   - Should see 2 running instances named `Lab Instance` (created by Auto Scaling)
     
<img width="1470" height="315" alt="Screenshot 2025-11-14 at 10 00 18 AM" src="https://github.com/user-attachments/assets/728fff2b-daeb-433b-b7a9-7d96bb7df3b4" />

2. **Check Target Group**
   - EC2 > Load Balancing > Target Groups > `LabTargetGroup` > Targets
   - Both instances should show "healthy" status

<img width="1470" height="694" alt="Screenshot 2025-11-14 at 10 18 15 AM" src="https://github.com/user-attachments/assets/68b922ee-f6e1-470f-ae68-93950acb0ae1" />


3. **Test Load Balancer**
   - EC2 > Load Balancing > Load Balancers > `ALB`
   - Copy DNS name from `ALB`
      - e.g, `ALB-944460201.us-east-1.elb.amazonaws.com`
   - Paste into browser
      - Should see web app


**Step 9: Test Auto Scaling Response**

1. **Check CloudWatch Alarms**
   - Search > CloudWatch > Alarms > All Alarms
   - Should see alarms for Average CPU Utilization

2. **Generate Load**
   - Access web app and use any built-in load test feature (if available)
   - Alternatively, run a stress test on instances

3. **Observe Scaling**
   - CloudWatch > Alarms: Watch for AlarmHigh to trigger
   - EC2 Dashboard > Instances: More instances appear as demand increases

4.  **Terminate all the running instances**
      - Did you receive an email notification and see an instance automatically created after a few minutes?
   

---
