# Lab: Build Your DB Server and Interact With Your DB Using an App

---

## Prerequisites

- AWS account with permissions for VPC, EC2, RDS
- Region: us-east-1 (N. Virginia) or your preferred region

---
## Architectural Diagram:

Here’s an ASCII architectural diagram of the AWS RDS lab, styled like your example.

```
+====================================================================================================+
|                                      AWS Cloud — Region: us-east-1                                 |
|                                                                                                    |
|  +----------------------------------------------------------------------------------------------+  |
|  |                                VPC: Lab VPC (CIDR 10.0.0.0/16)                               |  |
|  |                                                                                              |  |
|  |   Internet                                                                                   |  |
|  |      ^                                                                                       |  |
|  |      |  0.0.0.0/0                                                                            |  |
|  |  +---+-----------------+                                                                     |  |
|  |  | Internet Gateway    |  (Lab-igw)                                                          |  |
|  |  +---------------------+                                                                     |  |
|  |                                                                                              |  |
|  |  +-----------------------------------------+   +-------------------------------------------+ |  |
|  |  | Availability Zone: us-east-1a           |   | Availability Zone: us-east-1b             | |  |
|  |  |                                         |   |                                           | |  |
|  |  |  +-----------------------------------+  |   |  +-------------------------------------+  | |  |
|  |  |  | Public-subnet-01 (10.0.0.0/24)    |  |   |  | DB-subnet-02 (10.0.3.0/24) Private  |  | |  |
|  |  |  |  (Associated: Lab-public-rt)      |  |   |  | (no IGW route)                      |  | |  |
|  |  |  |                                   |  |   |  |                                     |  | |  |
|  |  |  |   +---------------------------+   |  |   |  |   +-----------------------------+   |  | |  |
|  |  |  |   | EC2: DBAppServer          |   |  |   |  |   | RDS MySQL: Standby          |   |  | |  |
|  |  |  |   | - Amazon Linux 2          |   |  |   |  |   | - Multi-AZ replica          |   |  | |  |
|  |  |  |   | - t2.micro                |   |  |   |  |   | - Public access: NO         |   |  | |  |
|  |  |  |   | - Public IP: Enabled      |   |  |   |  |   +-----------------------------+   |  | |  |
|  |  |  |   +-----------+---------------+   |  |   |  |        ^  DB SG                     |  | |  |
|  |  |  |         | Web SG                  |  |   |  +--------|----------------------------+  | |  |
|  |  |  +---------|-------------------------+  |   |           v                               | |  |
|  |  |            v                            |   |   Inbound: 3306 from Web SG               | |  |
|  |  |   Inbound: 80 (HTTP), 22 (SSH) from 0.0.0.0/0                                           | |  |
|  |  |   Outbound: All                                                                         | |  |
|  |  |                                                                                         | |  |
|  |  |  +-----------------------------------+                                                  | |  |
|  |  |  | DB-subnet-01 (10.0.1.0/24) Private|                                                  | |  |
|  |  |  | (no IGW route)                    |                                                  | |  |
|  |  |  |                                   |                                                  | |  |
|  |  |  |   +---------------------------+   |                                                  | |  |
|  |  |  |   | RDS MySQL: Primary        |   |                                                  | |  |
|  |  |  |   | - Multi-AZ                |   |                                                  | |  |
|  |  |  |   | - Public access: NO       |   |                                                  | |  |
|  |  |  |   +-----------+---------------+   |                                                  | |  |
|  |  |  |         | DB SG                   |                                                  | |  |
|  |  |  +---------|-------------------------+                                                  | |  |
|  |  |            v                                                             Synchronous    | |  |
|  |  |   Inbound: 3306 from Web SG                                              Replication    | |  |
|  |  |   Outbound: All                                                        <=============>  | |  |
|  |  |                                                                                         | |  |
|  |  +-----------------------------------------------------------------------------------------+ |  |
|  |                                                                                              |  |
|  |  Route Tables:                                                                               |  |
|  |   - Lab-public-rt: 0.0.0.0/0 -> Internet Gateway; associated to Public-subnet-01             |  |
|  |   - Default/Private RT: no route to IGW; associated to DB-subnet-01 and DB-subnet-02         |  |
|  +----------------------------------------------------------------------------------------------+  |
|                                                                                                    |
+====================================================================================================+

Traffic flow (simplified):
- Internet ⇄ IGW ⇄ EC2 (Public-subnet-01) for HTTP/SSH
- EC2 → RDS Primary on TCP 3306 (private VPC path)
- RDS Primary ⇄ RDS Standby: synchronous replication across AZs
- RDS is not publicly accessible (no public endpoint)
```


---

## 1. **Create a VPC**
   1. In the AWS Console, go to the **VPC** service.
   2. Click **Your VPCs** in the left navigation pane, then **Create VPC**.
   3. Select **VPC only**.
   4. Configure:
      - **Name tag:** `Lab VPC`
      - **IPv4 CIDR block:** `10.0.0.0/16`
      - **IPv6 CIDR block:** No IPv6 CIDR (leave unchecked/None)
      - **Tenancy:** Default
   5. Click **Create VPC**.

---

## 2. **Create Subnets** (at least three: one public, two private for DB)

   - Go to **Subnets** in the VPC console.
   - Click **Create subnet**.
   - Configure and create subnets as follows:

   **a) Public-subnet-01 (for Web/App Server)**
   - **VPC:** Lab VPC
   - **Subnet name:** `Public-subnet-01`
   - **Availability Zone:** `us-east-1a`
   - **IPv4 CIDR block:** `10.0.0.0/24`

   **b) DB-subnet-01 (Private for RDS)**
   - **VPC:** Lab VPC
   - **Subnet name:** `DB-subnet-01`
   - **Availability Zone:** `us-east-1a`
   - **IPv4 CIDR block:** `10.0.1.0/24`

   **c) DB-subnet-02 (Private for RDS)**
   - **VPC:** Lab VPC
   - **Subnet name:** `DB-subnet-02`
   - **Availability Zone:** `us-east-1b`
   - **IPv4 CIDR block:** `10.0.3.0/24`

   - Click **Create subnet** after configuring each.

---

## 3. **Create an Internet Gateway and Attach to VPC**

   1. Go to **Internet Gateways** in the VPC console.
   2. Click **Create internet gateway**.
      - **Name tag:** `Lab-igw`
   3. Create and **attach it to Lab VPC**.

---

## 4. **Configure Route Tables**

### a) **Public Route Table (for Public-subnet-01)**
   1. Go to **Route Tables** in the VPC console.
   2. Create a new route table:
      - **Name tag:** `Lab-public-rt`
      - **VPC:** Lab VPC
   3. Select the new route table, go to **Routes** tab > **Edit routes**.
      - Add route:
        - **Destination:** `0.0.0.0/0`
        - **Target:** Your Internet Gateway (`Lab-igw`)
   4. Go to **Subnet associations** tab > **Edit subnet associations**.
      - **Select:** `Public-subnet-01`
      - Click **Save associations**.

### b) **Private Route Table (optional, for DB subnets)**
   - The default route table (created with your VPC) can be used for private subnets. No route to Internet Gateway is needed for DB subnets.

---

## 5. **Create Security Groups**

### a) **Web Security Group**
- In **EC2 > Security Groups**
  - Name: `Web Security Group`
  - Description: Allow HTTP/SSH from anywhere (or your IP)
  - VPC: Lab VPC
  - Inbound Rule: HTTP (80) from `0.0.0.0/0`
  - Inbound Rule: SSH (22) from `0.0.0.0/0` or Only from your IP
  - Outbound: All traffic

### b) **DB Security Group**
- Name: `DB Security Group`
- Description: Permit access from Web Security Group
- VPC: Lab VPC
- Inbound Rule: MySQL/Aurora (3306) source from **Web Security Group** (select by SG ID)
- Outbound: All traffic

---

## 6. **Create a DB Subnet Group**

1. Go to **RDS > Subnet groups > Create DB Subnet Group**
2. Name: `Lab-DB-Subnet-Group`
3. Description: `DB Subnet Group`
4. VPC: Lab VPC
5. Add subnets: Availability Zones`us-east-1a` `us-east-1b`, Subnets: **DB-subnet-01** and **DB-subnet-02**
6. Create

---

## 7. **Launch Amazon RDS Multi-AZ DB Instance**

1. Go to **RDS > Databases > Create database**
2. Standard create
3. Engine: **MySQL**
4. Template: **Dev/Test**
5. Availability: **Multi-AZ DB instance(2 instances)**
6. Settings:
    - DB instance identifier: `lab-db`
    - Master username: `admin`
    - Self managed credentials
    - Master password: `lab-password`
7. DB instance class: Burstable classes `db.t3.micro`
8. Storage: General Purpose SSD (gp2), 20 GiB
9. Connectivity:
    - Don't connect to an EC2 compute resource
    - Network type: IPV4
    - VPC: Lab VPC
    - Subnet group: `Lab-DB-Subnet-Group`
    - **Public access: No**
    - VPC Security Group: **DB Security Group**
    - Enhanced Monitoring **Disable**
10. Additional configuration:
    - Initial database name: `lab`
11. Click **Create database**.
12. Wait until status is **Available**.  
    - Copy the **Endpoint** for later.
    - Click on your RDS database instance.
    - Under the Connectivity & security tab, look for Endpoint & port.
    - The endpoint will look like: `lab-db.cr0s8miyua9l.us-east-1.rds.amazonaws.com`

---

## 8. **Launch a Web Server EC2 Instance in the Public Subnet**

1. Go to **EC2 > Instances > Launch Instances**
    - Name: `DBAppServer`
    - AMI: Amazon Linux 2
    - Instance type: `t2.micro`
    - Key pair: Create/download as needed
    - Network: Edit **Lab VPC**, **Subnet: Public-subnet-01**
    - Auto-assign public IP: **Enable**
    - Security group: **Web Security Group**
    - Lunch instance
2. Wait for the instance to start.
3. Note the public IP address.

---

## 9. **Deploy a Web App on the Instance**

- Go to the directory where the key is located, `chmod 400 	dbkey.pem` 
- SSH into the instance:
   - Syntax `ssh -i <keypair.pem> ec2-user@<AppServer-Public-IP>`
     
  Example:
    ```sh
       ssh -i "dbkey.pem" ec2-user@3.231.105.221
    ```
    
- Install Apache, PHP, and MySQL client:
    ```sh
       sudo yum update -y
    ```
    ```sh
       sudo yum install -y httpd php php-mysqlnd
    ```
    ```sh
       sudo systemctl enable httpd
    ```
    ```sh
       sudo systemctl start httpd
    ```
- Deploy a sample PHP app that connects to MySQL using the RDS endpoint.
  
- Place your `index.php` and `config.php` in `/var/www/html/`
  
    - Example:
         `sudo vim index.php`
      
```php
    <?php
error_reporting(E_ALL);
ini_set('display_errors', 1);
require_once 'config.php';

// Create students table if it doesn't exist
$tableSql = "CREATE TABLE IF NOT EXISTS students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    age INT,
    college_name VARCHAR(100),
    program_name VARCHAR(100),
    year INT,
    semester VARCHAR(20)
)";
$conn->query($tableSql);

// Handle insert form submission
$insertMsg = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['add_student'])) {
    $fn = $conn->real_escape_string($_POST['first_name']);
    $ln = $conn->real_escape_string($_POST['last_name']);
    $age = intval($_POST['age']);
    $college = $conn->real_escape_string($_POST['college_name']);
    $program = $conn->real_escape_string($_POST['program_name']);
    $year = intval($_POST['year']);
    $semester = $conn->real_escape_string($_POST['semester']);

    $sql = "INSERT INTO students (first_name, last_name, age, college_name, program_name, year, semester)
            VALUES ('$fn', '$ln', $age, '$college', '$program', $year, '$semester')";
    if ($conn->query($sql)) {
        $insertMsg = "<span style='color: green;'>Student added successfully!</span>";
    } else {
        $insertMsg = "<span style='color: red;'>Error: {$conn->error}</span>";
    }
}

// Handle delete
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['delete_student'])) {
    $id = intval($_POST['student_id']);
    $sql = "DELETE FROM students WHERE id=$id";
    if ($conn->query($sql)) {
        $insertMsg = "<span style='color: green;'>Student deleted successfully!</span>";
    } else {
        $insertMsg = "<span style='color: red;'>Error deleting student: {$conn->error}</span>";
    }
}

// Handle edit - show edit form
$editStudent = null;
if (isset($_GET['edit'])) {
    $id = intval($_GET['edit']);
    $res = $conn->query("SELECT * FROM students WHERE id=$id");
    if ($res && $res->num_rows > 0) {
        $editStudent = $res->fetch_assoc();
    }
}

// Handle update
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['update_student'])) {
    $id = intval($_POST['student_id']);
    $fn = $conn->real_escape_string($_POST['first_name']);
    $ln = $conn->real_escape_string($_POST['last_name']);
    $age = intval($_POST['age']);
    $college = $conn->real_escape_string($_POST['college_name']);
    $program = $conn->real_escape_string($_POST['program_name']);
    $year = intval($_POST['year']);
    $semester = $conn->real_escape_string($_POST['semester']);

    $sql = "UPDATE students SET first_name='$fn', last_name='$ln', age=$age, college_name='$college', program_name='$program', year=$year, semester='$semester' WHERE id=$id";
    if ($conn->query($sql)) {
        $insertMsg = "<span style='color: green;'>Student updated successfully!</span>";
    } else {
        $insertMsg = "<span style='color: red;'>Error updating student: {$conn->error}</span>";
    }
}

// Handle search
$searchResult = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['search_student'])) {
    $fn = $conn->real_escape_string($_POST['search_first_name']);
    $ln = $conn->real_escape_string($_POST['search_last_name']);

    $sql = "SELECT * FROM students WHERE first_name='$fn' AND last_name='$ln' LIMIT 1";
    $res = $conn->query($sql);
    if ($res && $res->num_rows > 0) {
        $student = $res->fetch_assoc();
        $searchResult = "<h3>Student Found:</h3>
        <ul>
            <li>First Name: {$student['first_name']}</li>
            <li>Last Name: {$student['last_name']}</li>
            <li>Age: {$student['age']}</li>
            <li>College Name: {$student['college_name']}</li>
            <li>Program Name: {$student['program_name']}</li>
            <li>Year: {$student['year']}</li>
            <li>Semester: {$student['semester']}</li>
        </ul>";
    } else {
        $searchResult = "<span style='color: red;'>No student found with that name.</span>";
    }
}

// Get all students for display
$students = [];
$res = $conn->query("SELECT * FROM students ORDER BY id DESC");
if ($res) {
    while ($row = $res->fetch_assoc()) {
        $students[] = $row;
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Student Database Web App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        form { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; width: 350px;}
        h2 { margin-top: 0; }
        table { border-collapse: collapse; width: 90%; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background: #f1f1f1; }
        .btn { padding: 4px 10px; cursor: pointer; }
        .edit-link { color: #2980b9; text-decoration: none; }
        .del-btn { background: #e74c3c; color: white; border: none; }
    </style>
</head>
<body>
    <h1>Student Database Web App</h1>

    <?php echo $insertMsg; ?>

    <?php if ($editStudent): ?>
        <h2>Edit Student</h2>
        <form method="post">
            <input type="hidden" name="student_id" value="<?php echo $editStudent['id']; ?>">
            <label>First Name: <input type="text" name="first_name" required value="<?php echo htmlspecialchars($editStudent['first_name']); ?>"></label><br><br>
            <label>Last Name: <input type="text" name="last_name" required value="<?php echo htmlspecialchars($editStudent['last_name']); ?>"></label><br><br>
            <label>Age: <input type="number" name="age" required value="<?php echo htmlspecialchars($editStudent['age']); ?>"></label><br><br>
            <label>College Name: <input type="text" name="college_name" required value="<?php echo htmlspecialchars($editStudent['college_name']); ?>"></label><br><br>
            <label>Program Name: <input type="text" name="program_name" required value="<?php echo htmlspecialchars($editStudent['program_name']); ?>"></label><br><br>
            <label>Year: <input type="number" name="year" required value="<?php echo htmlspecialchars($editStudent['year']); ?>"></label><br><br>
            <label>Semester: <input type="text" name="semester" required value="<?php echo htmlspecialchars($editStudent['semester']); ?>"></label><br><br>
            <input type="submit" name="update_student" value="Update Student" class="btn">
            <a href="index.php" class="btn" style="background:#ccc;color:black;">Cancel</a>
        </form>
    <?php else: ?>
        <h2>Add New Student</h2>
        <form method="post">
            <label>First Name: <input type="text" name="first_name" required></label><br><br>
            <label>Last Name: <input type="text" name="last_name" required></label><br><br>
            <label>Age: <input type="number" name="age" required></label><br><br>
            <label>College Name: <input type="text" name="college_name" required></label><br><br>
            <label>Program Name: <input type="text" name="program_name" required></label><br><br>
            <label>Year: <input type="number" name="year" required></label><br><br>
            <label>Semester: <input type="text" name="semester" required></label><br><br>
            <input type="submit" name="add_student" value="Add Student" class="btn">
        </form>
    <?php endif; ?>

    <h2>Search Student</h2>
    <form method="post">
        <label>First Name: <input type="text" name="search_first_name" required></label><br><br>
        <label>Last Name: <input type="text" name="search_last_name" required></label><br><br>
        <input type="submit" name="search_student" value="Search" class="btn">
    </form>
    <?php echo $searchResult; ?>

    <?php if (count($students) > 0): ?>
        <h2>All Students</h2>
        <table>
            <tr>
                <th>ID</th><th>First Name</th><th>Last Name</th><th>Age</th><th>College Name</th>
                <th>Program Name</th><th>Year</th><th>Semester</th><th>Actions</th>
            </tr>
            <?php foreach ($students as $student): ?>
                <tr>
                    <td><?php echo $student['id']; ?></td>
                    <td><?php echo htmlspecialchars($student['first_name']); ?></td>
                    <td><?php echo htmlspecialchars($student['last_name']); ?></td>
                    <td><?php echo htmlspecialchars($student['age']); ?></td>
                    <td><?php echo htmlspecialchars($student['college_name']); ?></td>
                    <td><?php echo htmlspecialchars($student['program_name']); ?></td>
                    <td><?php echo htmlspecialchars($student['year']); ?></td>
                    <td><?php echo htmlspecialchars($student['semester']); ?></td>
                    <td>
                        <a href="?edit=<?php echo $student['id']; ?>" class="edit-link btn">Edit</a>
                        <form method="post" style="display:inline;">
                            <input type="hidden" name="student_id" value="<?php echo $student['id']; ?>">
                            <button type="submit" name="delete_student" class="del-btn btn" onclick="return confirm('Delete this student?');">Delete</button>
                        </form>
                    </td>
                </tr>
            <?php endforeach; ?>
        </table>
    <?php else: ?>
        <p>No students found.</p>
    <?php endif; ?>

</body>
</html>
```
      
    - Example :
       `sudo vim config.php`
       
```php
<?php
define('DB_HOST', 'lab-db.cr0s8miyua9l.us-east-1.rds.amazonaws.com'); // Replace with your own
define('DB_USER', 'admin');        // RDS master username (from your setup)
define('DB_PASS', 'lab-password'); // RDS master password
define('DB_NAME', 'lab');          // Initial database name
$conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}
?>
```

- Manage permission:
  
```bash
sudo chown apache:apache /var/www/html/*.php
```

```bash
sudo chmod 644 /var/www/html/*.php
```

-  Restart the Apache web server
```bash
sudo systemctl restart httpd
```
---

## 10. **Connect the App to the RDS Database**

1. Open your web app (browser, using the EC2 public IP).
2. Your PHP app should connect to the RDS endpoint with the credentials above.

---

## 11. **Test and Validate**

- Add/edit/delete records in the app.
- Confirm data persists and is stored in the RDS database.

<img width="950" height="520" alt="Screenshot 2025-09-16 at 12 32 41 PM" src="https://github.com/user-attachments/assets/53359f61-c012-4bb6-a8d0-2bc8c7fbe347" />

<img width="932" height="854" alt="Screenshot 2025-09-16 at 12 31 33 PM" src="https://github.com/user-attachments/assets/2c9a0fc5-6e53-4cf6-85a2-c96fc404eac5" />

<img width="1470" height="786" alt="Screenshot 2025-09-16 at 12 40 02 PM" src="https://github.com/user-attachments/assets/9e68465a-c1bb-4fd1-92dd-aa4f4cd8db8a" />


---

## 12. **(Optional) Clean Up Resources**

- Terminate EC2 instance
- Delete RDS DB instance and snapshots
- Delete security groups, subnet group, subnets, route tables, and VPC

---

## **Troubleshooting**

| Symptom                   | Possible Cause                       | Fix                                  |
|---------------------------|--------------------------------------|--------------------------------------|
| App can't connect to DB   | Security groups, wrong endpoint      | Check DB SG, use correct endpoint    |
| RDS not accessible        | Wrong VPC/subnet group/Security group| Check networking and SG config       |
| No public IP on instance  | Subnet not public/auto-assign off    | Use public subnet, assign public IP  |
| App errors                | PHP/MySQL not installed              | Install required packages            |

---

## **Architecture Recap**

```
[Internet]
   |
   v
[AppServer EC2] --(Web SG)--> [RDS MySQL Multi-AZ] --(DB SG)-->
     |                        ^
     |                        |
[Public Subnet]        [Private Subnets in 2 AZs]
```

---
## Challenge (Optional): Create a complete, production-ready JavaScript full-stack app that replicates the PHP student-registration app from earlier.

- **Backend:** Node.js (Express)
- **Database:** MySQL (connect to AWS RDS)
- **Frontend:** React (single-page app)
- **API:** RESTful
- **Features:** Add, search, edit, and delete students
- **Security:** Basic input validation, CORS enabled


## Hints: 

---

**Directory structure:**
```
/var/www/html/frontend/
├── package.json
├── public/
│   └── index.html
├── src/
│   ├── App.js
│   └── index.js
```
---
---

## 1. **Backend (Node.js/Express)**

Create a folder called `backend/`, and add the following files:

---

### `backend/package.json`
```json name=backend/package.json
{
  "name": "student-db-backend",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "mysql2": "^3.5.2"
  }
}
```

---

### `backend/db.js`
```javascript name=backend/db.js
const mysql = require('mysql2/promise');

const pool = mysql.createPool({
  host: 'lab-db.cr0s8miyua9l.us-east-1.rds.amazonaws.com', // RDS endpoint
  user: 'admin', // RDS username
  password: 'lab-password', // RDS password
  database: 'lab', // Database name
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
});

module.exports = pool;
```

---

### `backend/server.js`
```javascript name=backend/server.js
const express = require('express');
const cors = require('cors');
const pool = require('./db');

const app = express();
app.use(cors());
app.use(express.json());

// Ensure table exists
(async () => {
  try {
    const sql = `CREATE TABLE IF NOT EXISTS students (
      id INT AUTO_INCREMENT PRIMARY KEY,
      first_name VARCHAR(50) NOT NULL,
      last_name VARCHAR(50) NOT NULL,
      age INT,
      college_name VARCHAR(100),
      program_name VARCHAR(100),
      year INT,
      semester VARCHAR(20)
    )`;
    const conn = await pool.getConnection();
    await conn.query(sql);
    conn.release();
  } catch (err) {
    console.error('Error creating students table:', err);
  }
})();

// Add student
app.post('/api/students', async (req, res) => {
  try {
    const { first_name, last_name, age, college_name, program_name, year, semester } = req.body;
    if (!first_name || !last_name) {
      return res.status(400).json({ error: 'First name and last name are required.' });
    }
    const [result] = await pool.query(
      'INSERT INTO students (first_name, last_name, age, college_name, program_name, year, semester) VALUES (?, ?, ?, ?, ?, ?, ?)',
      [first_name, last_name, age, college_name, program_name, year, semester]
    );
    res.json({ id: result.insertId });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// Get all students
app.get('/api/students', async (req, res) => {
  try {
    const [rows] = await pool.query('SELECT * FROM students ORDER BY id DESC');
    res.json(rows);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// Search student by first and last name
app.get('/api/students/search', async (req, res) => {
  try {
    const { first_name, last_name } = req.query;
    const [rows] = await pool.query(
      'SELECT * FROM students WHERE first_name = ? AND last_name = ? LIMIT 1',
      [first_name, last_name]
    );
    if (rows.length === 0) return res.status(404).json({ error: 'No student found.' });
    res.json(rows[0]);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// Edit student
app.put('/api/students/:id', async (req, res) => {
  try {
    const { id } = req.params;
    const { first_name, last_name, age, college_name, program_name, year, semester } = req.body;
    const [result] = await pool.query(
      'UPDATE students SET first_name=?, last_name=?, age=?, college_name=?, program_name=?, year=?, semester=? WHERE id=?',
      [first_name, last_name, age, college_name, program_name, year, semester, id]
    );
    res.json({ success: result.affectedRows > 0 });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// Delete student
app.delete('/api/students/:id', async (req, res) => {
  try {
    const { id } = req.params;
    const [result] = await pool.query('DELETE FROM students WHERE id=?', [id]);
    res.json({ success: result.affectedRows > 0 });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

const PORT = process.env.PORT || 4000;
app.listen(PORT, () => console.log(`Server running on port ${PORT}`));
```

---

## 2. **Frontend (React)**

Create a folder called `frontend/`, and add the following files:

---

### `frontend/package.json`
```json name=frontend/package.json
{
  "name": "student-db-frontend",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build"
  },
  "dependencies": {
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "react-scripts": "^5.0.1",
    "axios": "^1.6.7"
  }
}
```

---

### `frontend/src/App.js`
```javascript name=frontend/src/App.js
import React, { useState, useEffect } from "react";
import axios from "axios";

const API = "http://localhost:4000/api/students";

function App() {
  const [students, setStudents] = useState([]);
  const [form, setForm] = useState({
    first_name: "",
    last_name: "",
    age: "",
    college_name: "",
    program_name: "",
    year: "",
    semester: ""
  });
  const [editId, setEditId] = useState(null);
  const [searchForm, setSearchForm] = useState({
    first_name: "",
    last_name: ""
  });
  const [searchResult, setSearchResult] = useState(null);
  const [msg, setMsg] = useState("");

  useEffect(() => {
    fetchStudents();
  }, []);

  const fetchStudents = async () => {
    const res = await axios.get(API);
    setStudents(res.data);
  };

  const handleChange = (e) => {
    setForm({ ...form, [e.target.name]: e.target.value });
  };
  const handleSearchChange = (e) => {
    setSearchForm({ ...searchForm, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (editId) {
      await axios.put(`${API}/${editId}`, form);
      setMsg("Student updated successfully!");
      setEditId(null);
    } else {
      await axios.post(API, form);
      setMsg("Student added successfully!");
    }
    setForm({
      first_name: "",
      last_name: "",
      age: "",
      college_name: "",
      program_name: "",
      year: "",
      semester: ""
    });
    fetchStudents();
  };

  const handleEdit = (student) => {
    setEditId(student.id);
    setForm(student);
    setMsg("");
  };

  const handleDelete = async (id) => {
    if (window.confirm("Delete this student?")) {
      await axios.delete(`${API}/${id}`);
      setMsg("Student deleted successfully!");
      fetchStudents();
    }
  };

  const handleSearch = async (e) => {
    e.preventDefault();
    try {
      const res = await axios.get(`${API}/search`, { params: searchForm });
      setSearchResult(res.data);
    } catch (err) {
      setSearchResult(null);
      setMsg("No student found.");
    }
  };

  return (
    <div style={{ fontFamily: "Arial, sans-serif", margin: 40 }}>
      <h1>Student Database Web App</h1>
      {msg && <div style={{ color: "green" }}>{msg}</div>}

      <h2>{editId ? "Edit Student" : "Add New Student"}</h2>
      <form onSubmit={handleSubmit} style={{ marginBottom: 20, padding: 15, border: "1px solid #ccc", width: 350 }}>
        <label>First Name: <input type="text" name="first_name" required value={form.first_name} onChange={handleChange} /></label><br /><br />
        <label>Last Name: <input type="text" name="last_name" required value={form.last_name} onChange={handleChange} /></label><br /><br />
        <label>Age: <input type="number" name="age" required value={form.age} onChange={handleChange} /></label><br /><br />
        <label>College Name: <input type="text" name="college_name" required value={form.college_name} onChange={handleChange} /></label><br /><br />
        <label>Program Name: <input type="text" name="program_name" required value={form.program_name} onChange={handleChange} /></label><br /><br />
        <label>Year: <input type="number" name="year" required value={form.year} onChange={handleChange} /></label><br /><br />
        <label>Semester: <input type="text" name="semester" required value={form.semester} onChange={handleChange} /></label><br /><br />
        <button type="submit">{editId ? "Update Student" : "Add Student"}</button>
        {editId && <button type="button" onClick={() => { setEditId(null); setForm({ first_name: "", last_name: "", age: "", college_name: "", program_name: "", year: "", semester: "" }); }}>Cancel</button>}
      </form>

      <h2>Search Student</h2>
      <form onSubmit={handleSearch} style={{ marginBottom: 20, padding: 15, border: "1px solid #ccc", width: 350 }}>
        <label>First Name: <input type="text" name="first_name" required value={searchForm.first_name} onChange={handleSearchChange} /></label><br /><br />
        <label>Last Name: <input type="text" name="last_name" required value={searchForm.last_name} onChange={handleSearchChange} /></label><br /><br />
        <button type="submit">Search</button>
      </form>
      {searchResult && (
        <div>
          <h3>Student Found:</h3>
          <ul>
            <li>First Name: {searchResult.first_name}</li>
            <li>Last Name: {searchResult.last_name}</li>
            <li>Age: {searchResult.age}</li>
            <li>College Name: {searchResult.college_name}</li>
            <li>Program Name: {searchResult.program_name}</li>
            <li>Year: {searchResult.year}</li>
            <li>Semester: {searchResult.semester}</li>
          </ul>
        </div>
      )}

      <h2>All Students</h2>
      <table style={{ borderCollapse: "collapse", width: "90%" }}>
        <thead>
          <tr>
            <th>ID</th><th>First Name</th><th>Last Name</th><th>Age</th><th>College Name</th>
            <th>Program Name</th><th>Year</th><th>Semester</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {students.map(student =>
            <tr key={student.id}>
              <td>{student.id}</td>
              <td>{student.first_name}</td>
              <td>{student.last_name}</td>
              <td>{student.age}</td>
              <td>{student.college_name}</td>
              <td>{student.program_name}</td>
              <td>{student.year}</td>
              <td>{student.semester}</td>
              <td>
                <button onClick={() => handleEdit(student)}>Edit</button>
                <button style={{ color: "white", background: "#e74c3c", marginLeft: 5 }} onClick={() => handleDelete(student.id)}>Delete</button>
              </td>
            </tr>
          )}
        </tbody>
      </table>
    </div>
  );
}

export default App;
```

---

### `frontend/src/index.js`
```javascript name=frontend/src/index.js
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App";

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
```

---

### `frontend/public/index.html`
```html name=frontend/public/index.html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Database Web App</title>
</head>
<body>
  <div id="root"></div>
</body>
</html>
```

---

## 3. **How to Run**

**Backend:**
1.  Install Node.js and npm (On Amazon Linux 2) run:

`curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs`

2. Edit `backend/db.js` with your actual RDS credentials.
3. Run:
   ```sh
   cd backend
   npm install
   npm start
   ```

**Frontend:**
1. Run:
   ```sh
   cd frontend
   npm install
   npm start
   ```
>By default, frontend runs on: localhost:3000 and expects backend at: localhost:4000


**Access the App**
Frontend:
   Open `http://<your-ec2-public-ip>:3000` in your browser.
   
Backend API: 
   Runs on port 4000 by default `http://<your-ec2-public-ip>:4000`

**Deploying to Production:**
- Use environment variables for database secrets.
- Serve the React build with Express in production.
- Secure API routes, add authentication if needed.

---


