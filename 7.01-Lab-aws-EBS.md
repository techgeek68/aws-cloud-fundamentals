# Lab: Working with Amazon EBS

---
## Objectives

In this lab, you will:

- Create an Amazon EBS volume
- Attach and mount your volume to an EC2 instance
- Create a snapshot of your volume
- Create a new volume from your snapshot
- Attach and mount the new volume to your EC2 instance

---

## Prerequisites

- AWS account with permissions for EC2 and EBS
- Region: us-east-1 (N. Virginia) or your preferred region
  
---
## Architectural Diagram:
```
+-------------------------+
|      AWS EC2 Instance   |
|         "Lab"           |
+-----------+-------------+
            |
   +--------v----------------+
   |    Root Volume          |
   |   (8 GiB, /dev/xvda1)   |
   +-------------------------+
            |
   +--------v-----------------------+
   |  My Volume                     |
   |  (1 GiB, /dev/sdf → /dev/xvdf) |
   +--------------------------------+
            |
   +--------v--------+
   |   My Snapshot   |
   +-----------------+
            |
   +--------v-------------------------------+
   |  Restored Volume                       |
   |  (from Snapshot, /dev/sdg → /dev/xvdg) |
   +----------------------------------------+
```

---

## Step 1: Launch an EC2 Instance

1. Go to **EC2 > Instances > Launch Instances**.
2. Configure:
    - **Name:** `EBSLab`
    - **AMI:** Amazon Linux 2 (or latest Amazon Linux)
    - **Instance type:** `t2.micro`
    - **Key pair:** Create. (Private key pair will be automatically downloaded.)
    - **Network:** Select default VPC and respective subnet (or Create custom)
    - **Storage:** Keep default (8 GiB EBS root volume)
    - **Security Group:**
      - Create a Security Group: Security group name:`EBSLab`
        - Allow SSH (port 22) from your IP or anywhere
3. **Launch** the instance and wait until the state is `running`.
4. **Note the Availability Zone** (e.g., `us-east-1a`).

---

## Step 2: Create a New EBS Volume

1. Go to **EC2 > Elastic Block Store > Volumes > Create Volume**.
2. Set:
    - **Volume type:** General Purpose SSD (gp2)
    - **Size:** 1 GiB
    - **Availability Zone:** *same as your EC2 instance* `e.g. us-east-1a`
    - **Tag:** Key = `Name`, Value = `My Volume`
3. Click **Create Volume**.

---

## Step 3: Attach the Volume to Your EC2 Instance

1. In **EC2 > Elastic Block Store > Volumes**, select **My Volume**.
2. Click **Actions > Attach volume**.
3. Select your `EBSLab` instance.
4. **Device:** `/dev/sdf` (default)
5. Click **Attach volume**.

---

## Step 4: Connect to Your EC2 Instance

1. Click on the `EBSLab` instance.
2. Click **Connect** > **EC2 Instance Connect** or use **SSH** from your terminal.
3. Using **EC2 Instance Connect**
   - Click on **connect** bottom of the right side
4. Using **SSH**
   - Open terminal
   - chmod 400 "KeyPairname.pem" `e.g. chmod 400 EBSLab.pem`
   - Login using an SSH client
     `e.g. ssh -i "EBSLab.pem" ec2-user@ec2-44-211-28-60.compute-1.amazonaws.com`
---

## Step 5: Create and Mount a File System

1. **Check existing disks:**
    ```sh
    lsblk        #lists information about block devices (like hard drives, SSDs, USBs, partitions).
    ```
    ```
    df -h        #shows disk space usage in human-readable format (GB/MB) with the mounted location.              
    ```
2. **Format the new EBS volume:**
    ```sh
      sudo mkfs -t ext3 /dev/xvdf        or       sudo mkfs.ext3 /dev/xvdf
    ```
              *Note: `/dev/sdf` appears as `/dev/xvdf` in Linux.*
   
4. **Create mount point:**
    ```sh
      sudo mkdir /mnt/data-store
    ```
5. **Mount the volume:**
    ```sh
    sudo mount /dev/xvdf /mnt/data-store
    ```
    Verify:
   ```sh
     lsblk
   ```
7. **Make mount persistent:**
    ```sh
    echo "/dev/xvdf   /mnt/data-store ext3 defaults,noatime 1 2" | sudo tee -a /etc/fstab
    ```
8. **Verify mount:**
    ```sh
    df -h
    ```
9. **Create a test file:**
    ```sh
    sudo sh -c "echo some text has been written > /mnt/data-store/file.txt"
    ```
    ```sh
    cat /mnt/data-store/file.txt
    ```

---

## Step 6: Create an EBS Snapshot

1. In **EC2 > Volumes**, select **My Volume**.
2. **Actions > Create Snapshot**.
3. Tag: Key = `Name`, Value = `My Snapshot`.
4. Click **Create Snapshot**.
5. Wait for snapshot state to become **Completed**.

---

## Step 7: Delete the File (to Test Recovery)

*On the EC2 instance:*
```sh
  sudo rm /mnt/data-store/file.txt
```
```sh
  ls /mnt/data-store/
```

---

## Step 8: Restore Data from Snapshot

### Create New Volume from Snapshot

1. In **EC2 > Elastic Block Store > Snapshots**, select **My Snapshot**.
2. **Actions > Create Volume from Snapshot**.
3. **Availability Zone:** *same as your EC2 instance*
4. Tag: Key = `Name`, Value = `Restored Volume`
5. Click **Create Volume**.

### Attach the Restored Volume

1. In **EC2 > Volumes**, select **Restored Volume**.
2. **Actions > Attach Volume**.
3. Select your instance.
4. Device: `/dev/sdg`
5. Click **Attach Volume**.

### Mount the Restored Volume

*On the EC2 instance:*
```sh
  sudo mkdir /mnt/data-store2
```
```sh
  sudo mount /dev/xvdg /mnt/data-store2
```
```sh
  ls /mnt/data-store2/
```
```sh
  cat /mnt/data-store2/file.txt
```

  *You should see your previously created file restored!*

---

## Step 9: (Optional) Clean Up

- Detach and delete EBS volumes.
- Delete snapshots.
- Terminate EC2 instance.

---

## Troubleshooting

| Symptom      | Possible Cause      | Fix                                      |
|--------------|--------------------|-------------------------------------------|
| Volume not visible | Wrong AZ      | Volume and instance must be in same AZ    |
| Can't mount  | Wrong device name  | Use `/dev/xvdf` or `/dev/xvdg` for Linux  |
| File missing | Wrong volume/snapshot | Ensure correct snapshot/volume is used |

---
### Discussion & Conclucion:




---
